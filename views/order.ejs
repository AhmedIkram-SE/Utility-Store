<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!--========== BOX ICONS ==========-->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/boxicons@latest/css/boxicons.min.css"
    />

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css"
      integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh"
      crossorigin="anonymous"
    />
    <!--========== CSS ==========-->
    <link rel="stylesheet" href="css/home.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Nastaliq+Urdu:wght@700&display=swap"
      rel="stylesheet"
    />
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <link
      rel="shortcut icon"
      href="image/bx-store.svg"
      class="bx bx-cart"
      type="image/x-icon"
    />
    <title>UtilityStore</title>
  </head>
  <body>
    <!--========== HEADER ==========-->
    <header class="header">
      <div class="header__container">
        <img src="image/pakistan.jpg" alt="" class="header__img" />

        <a href="#" class="header__logo">
          <img src="image/us.jpeg" class="mylogo" alt=""
        /></a>

        <div class="header__logo urdu">معیاری اشیا‍‌ء ۔۔۔۔۔۔۔ مناسب دام</div>

        <div class="header__toggle">
          <i class="bx bx-menu" id="header-toggle"></i>
        </div>
      </div>
    </header>

    <!--========== NAV ==========-->
    <div class="nav" id="navbar">
      <nav class="nav__container">
        <div>
          <a href="/home" class="nav__link nav__logo">
            <i class="bx bx-cart nav__icon active"></i>
            <span class="nav__logo-name active">Utility Store</span>
          </a>

          <div class="nav__list">
            <div class="nav__items">
              <h3 class="nav__subtitle">Functionalities</h3>

              <a href="/home" class="nav__link">
                <i class="bx bx-home nav__icon"></i>
                <span class="nav__name">DashBoard</span>
              </a>
              <a href="/customer" class="nav__link">
                <i class="bx bx-user nav__icon"></i>
                <span class="nav__name">Customer Registration</span>
              </a>
              <a href="/product" class="nav__link">
                <i class="bx bx-store nav__icon"></i>
                <span class="nav__name">Product Management</span>
              </a>
              <a href="/pos" class="nav__link">
                <i class="bx bx-box nav__icon"></i>
                <span class="nav__name">POS</span>
              </a>
              <a href="/order" class="nav__link">
                <i class="bx bx-receipt nav__icon"></i>
                <span class="nav__name">Orders Details</span>
              </a>
              <a href="/sales" class="nav__link">
                <i class="bx bx-table nav__icon"></i>
                <span class="nav__name">Sales Info</span>
              </a>
              <a href="/stock" class="nav__link">
                <i class="bx bx-package nav__icon"></i>
                <span class="nav__name">Stock Management</span>
              </a>
              <a href="/customerdetails" class="nav__link">
                <i class="bx bx-user-pin nav__icon"></i>
                <span class="nav__name">Customer Details</span>
              </a>
            </div>
          </div>
        </div>

        <a href="/" class="nav__link nav__logout">
          <i class="bx bx-log-out nav__icon"></i>
          <span class="nav__name">Log Out</span>
        </a>
      </nav>
    </div>

    <!--========== CONTENTS ==========-->
    <main class="hehe container-fluid">
      <div class="container-fluid">
        <div class="input-group mb-3">
          <span class="input-group-text" id="inputGroup-sizing-default"
            >CNIC</span
          >
          <input
            type="text"
            class="form-control cnic-js"
            aria-label="Sizing example input"
            aria-describedby="inputGroup-sizing-default"
          />
          <button class="btn btn-success search-js">Search</button>
        </div>
        <div class="input-group mb-3">
          <span class="input-group-text">SALE ID</span>
          <input
            type="text"
            class="form-control saleid-js"
            aria-label="Sizing example input"
            aria-describedby="inputGroup-sizing-default"
          />
          <button class="btn btn-success sale-search-js">Search</button>
        </div>
        <table class="table table-success opacity table-striped tb">
          <thead>
            <tr>
              <th scope="col">Sale Id</th>
              <th scope="col">Customer Name</th>
              <th scope="col">CNIC</th>
              <th scope="col">Product Name</th>
              <th scope="col">Purchased Quantity</th>
              <th scope="col">Date</th>
            </tr>
          </thead>
          <tbody class="table-data">
            <!-- <tr>
              <td>1</td>
              <td>Yaseen Nazir</td>
              <td>35201-5077458-1</td>
              <td>Orange Juice</td>
              <td>3</td>
              <td>23-01-2023</td>
            </tr> -->
          </tbody>
        </table>
      </div>
    </main>

    <!--========== MAIN JS ==========-->
    <script src="assets/js/main.js"></script>
    <script>
      let sales = [];
      function renderTableRow(data) {
        for (var i = 0; i < data.length; i++) {
          var row = "<tr>";
          row += "<td>" + data[i].SALEID + "</td>";
          row += "<td>" + data[i].CUSTOMERNAME + "</td>";
          row += "<td>" + data[i].CNIC + "</td>";
          row += "<td>" + data[i].PRODUCTNAME + "</td>";
          row += "<td>" + data[i].PURCHASEDQUANTITY + "</td>";
          var dateObject = new Date(data[i].SALEDATE);
          var day = dateObject.getDate().toString().padStart(2, "0");
          var month = (dateObject.getMonth() + 1).toString().padStart(2, "0");
          var year = dateObject.getFullYear();
          var formattedDate = day + "-" + month + "-" + year;
          row += "<td>" + formattedDate + "</td>";
          row += "</tr>";

          // Append the row to the table body
          $(".table-data").append(row);
        }
      }

      $(".search-js").on("click", function () {
        $(".table-data").empty();
        // Get the value from the input field
        var cnicValue = $(".cnic-js").val();
        // Make an AJAX request to localhost/order with the input field data
        $.ajax({
          url: "http://localhost:80/customer/" + cnicValue,
          method: "GET",
          dataType: "json",
          success: function (res) {
            sales = res.data;
            console.log(sales);
            if (sales.length > 0) {
              renderTableRow(sales);
            } else {
              alert("No Record Found");
            }
          },
          error: function (xhr, status, error) {
            alert("No CNIC found");
            console.error("Error:", error);
          },
        });
      });

      $(".sale-search-js").on("click", function () {
        $(".table-data").empty();
        // Get the value from the input field
        var saleId = $(".saleid-js").val();
        console.log(saleId);
        // Make an AJAX request to localhost/order with the input field data
        $.ajax({
          url: "http://localhost:80/customers/" + saleId,
          method: "GET",
          dataType: "json",
          success: function (res) {
            sales = res.data;
            console.log(sales);
            if (sales.length > 0) {
              renderTableRow(sales);
            } else {
              alert("No Sale ID found");
            }
          },
          error: function (xhr, status, error) {
            alert("No Sale ID founds");
            console.error("Error:", error);
          },
        });
      });
    </script>
  </body>
</html>
